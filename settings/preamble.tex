% !TEX root = ../main.tex

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% LaTeX preamble where all required packages and macros can be defined. 
% This needs to be done before the \begin{document} command.

% Select document class first
\documentclass[fleqn]{scrbook}

\KOMAoptions{
    paper=a4,               % A4 paper size
    fontsize=11pt,          % font size
    DIV=12,                 % calculate page dividers
    BCOR=0mm,               % binding correction, none
    twoside=off,            % print on single side paper
    listof=totoc,           % put lists of figures/tables in TOC
    footlines=2,            % number of lines in the footer
    usegeometry             % using geometry package
}

\usepackage{scrhack}        % better interactions with other packages of KOMA script

\usepackage[
    bottom=9em,
    footskip=3em
]{geometry}                 % page sizes

% Customize headers and footers
\usepackage[
    headsepline,            % header line
    footsepline             % footer line
]{scrlayer-scrpage}

\automark{chapter}
\ihead{\headmark}       % inner header value
\chead{}                % center header value
\ohead{Paul Iacomi}     % outer header value

\setcounter{tocdepth}{2}    % depth of TOC

%%%%%%%%%%%%%%%%%%%%%% Encodings, fonts and colours

% Font encodings
\usepackage{fourier}
\usepackage[TS1,T1]{fontenc}

% UNICODE recognition:
% This package should recognise any UNICODE characters in the text and automatically replace them with their standard macros
\usepackage[utf8]{inputenc}

% For colour definitions
\usepackage{xcolor}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}


%%%%%%%%%%%%%%%%%%%%%% Bibliography packages and settings

% Natbib package for text references
\usepackage[
    sectionbib,
    round,
    super,
    comma,
    sort&compress
]{natbib}
\usepackage{chapterbib}
% Moves references after punctuation
\usepackage{natmove}
\renewcommand*{\natmovechars}{.}
% Adds bibliography to TOC
\usepackage[nottoc]{tocbibind}

%%%%%%%%%%%%%%%%%%%%%% Science-related packages

% AMS maths packages
\usepackage{
    amsmath,
    amsfonts,
    amsthm,
    % amssymb
}

% In-line fractions
\usepackage{xfrac}

% The SIunitx package enables the \SI{}{} command.
\usepackage{siunitx}

% The mchem package for formula subscripts using \ce{}
\usepackage[version=4]{mhchem} 


%%%%%%%%%%%%%%%%%%%%%% Packages for graphs, tables and listings

% Graphics package and path to graphics.
\usepackage{graphicx}
\graphicspath{ {figures/} }

% Wrapping around figures
\usepackage{wrapfig}

% For better looking captions.
\usepackage{caption}
\captionsetup{
    margin=10pt,
    font=footnotesize,
    labelfont=bf,
    format=plain
}

% For subfigures
\usepackage{subcaption}

% For float barriers and such
\usepackage{float}
\usepackage{placeins}

% Better tables 
\usepackage{
    booktabs,
    makecell,
    array,
    multirow,
    tabularx
    }

% For code snippets
\usepackage{listings}

\lstdefinestyle{pythonstyle}{
    language=Python,                        % using Python
    backgroundcolor=\color{backcolour},     % background colour
    basicstyle=\footnotesize\ttfamily,      % style for the entire code
    keywordstyle=\color{magenta},           % style for keywords
    commentstyle=\color{codegreen},         % style for comments 
    stringstyle=\color{codepurple},         % style for strings
    numberstyle=\tiny\color{codegray},      % style of line numbers
    emph={False, True},                     % emphasise booleans
    emphstyle={\color{blue}},               % with blue
    captionpos=t,                           % where to put the caption
    breaklines=true,                        % activates or deactivates automatic line breaking of long line
    breakatwhitespace=false,                % if true only breaks at whitespaces
    frame=single,                           % adds a frame around the listing
    numbers=left,                           % line numbers
    numbersep=5pt,                          % distance between number and listing
    keepspaces=true,                        % do not drop spaces to keep alignment
    showspaces=false,                       % highlight spaces in code
    showstringspaces=false,                 % highlight spaces in strings
    showtabs=false,                         % highlight tabs in code
    tabsize=4                               % spaces inserted for each tbl
}

\lstdefinestyle{pythonoutputstyle}{
    basicstyle=\footnotesize\ttfamily,      % style for the entire code
    keywordstyle=\color{magenta},           % style for keywords
    commentstyle=\color{codegreen},         % style for comments 
    stringstyle=\color{codepurple},         % style for strings
    numberstyle=\tiny\color{codegray},      % style of line numbers
    captionpos=t,                           % where to put the caption
    breaklines=true,                        % activates or deactivates automatic line breaking of long line
    breakatwhitespace=false,                % if true only breaks at whitespaces
    frame=leftline,                         % adds a line
    xleftmargin=15pt,                       % left margin
    keepspaces=true,                        % do not drop spaces to keep alignment
    showspaces=false,                       % highlight spaces in code
    showstringspaces=false,                 % highlight spaces in strings
    showtabs=false,                         % highlight tabs in code
    tabsize=4                               % spaces inserted for each tbl
}

\lstnewenvironment{python}[1][]
    {\lstset{style=pythonstyle, #1}}
    {}
\lstnewenvironment{pythonout}[1][]
    {\lstset{style=pythonoutputstyle, #1}}
    {}

\newcommand{\inline}{\lstinline[style=pythonstyle, keywordstyle={}]}


%%%%%%%%%%%%%%%%%%%%%% Miscellaneous

% Todo notes. Used for notes and annotations.
\usepackage{todonotes}


%%%%%%%%%%%%%%%%%%%%%% References and bookmarks

% To reference another document, in this case the SI
\usepackage{zref-xr,zref-user}
\zxrsetup{
    tozreflabel=false, 
    toltxlabel=true, 
    verbose
}
%\zexternaldocument*{si}

% This package makes all references clickable. 
\usepackage{hyperref}
% Adding package bookmark improves bookmarks handling.
% More features and faster updated bookmarks.
\usepackage{bookmark}

\hypersetup{
    % bookmarks=true,                         %% Acrobat bookmarks (default)
    bookmarksnumbered=true,                 %% Add numbers to bookmarks
    bookmarksopen=true,                     %% bookmarks default open
    bookmarksopenlevel=2,                   %% Level 2 bookmarks
    % backref=true,                         %% add links in bib (default)
    % pagebackref=true,                     %% in the bibliography (default)
    % hyperindex=true,                      %% in the index (default)
    breaklinks=true,                        %% break lines if long
    colorlinks=false,                       %% colour links
    urlcolor=blue,                          %% link colour
    citecolor=blue,	                        %% bibliography link color
    linkcolor=blue,	                        %% internal link color
    anchorcolor=blue,                       %% anchor link color
    linktocpage=false,                      %% pagenumber link in TOC
    pdfborder={0 0 0}                       %% pdf border settings
}


%%%%%%%%%%%%%%%%%%%%%% Nomenclature and other glossaries

%%% glossaires
\usepackage[
    acronym,                                        % list of acronyms
    xindy,                                          % xindy compiler
    toc,                                            % display in TOC
    style=altlist                                   % display entries
]{glossaries}                                       % glossaries (must be loaded after hyperref)
\newglossary[nlg]{notation}{not}{ntn}{Nomenclature} % create new type of glossary for nomenclature
\makeglossaries{}                                   % generate glossaries
\loadglsentries{frontmatter/glossaries}             % glossary source file
